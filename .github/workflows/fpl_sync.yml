name: TW MM Tournament Sync Robot

on:
  schedule:
    # á† á€”á€¬á€›á€®á€á€¼á€¬á€¸ á€á€…á€ºá€á€« á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º Run á€›á€”á€º (UTC Time)
    - cron: '0 */6 * * *'
  
  # GitHub Actions Tab á€™á€¾ Manual Run á€›á€”á€º
  workflow_dispatch:

jobs:
  fpl_sync_job:
    runs-on: ubuntu-latest

    # GitHub á€‘á€²á€á€­á€¯á€· JSON á€–á€­á€¯á€„á€ºá€•á€¼á€”á€ºá€›á€±á€¸á€›á€”á€º Permission á€•á€±á€¸á€á€¼á€„á€ºá€¸
    permissions:
      contents: write

    steps:
      # áá‹ GitHub á€›á€¾á€­ á€–á€­á€¯á€„á€ºá€™á€»á€¬á€¸á€€á€­á€¯ Checkout á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
      - name: Checkout Repository Code
        uses: actions/checkout@v3

      # á‚á‹ Python Version 3.9 á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸
      - name: Set up Python 3.9
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # áƒá‹ á€œá€­á€¯á€¡á€•á€ºá€á€±á€¬ Library á€™á€»á€¬á€¸á€€á€­á€¯ Install á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests firebase-admin
          if [ -f scripts/requirements.txt ]; then pip install -r scripts/requirements.txt; fi

      # á„á‹ Firebase Rankings á€€á€­á€¯ Sync á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
      - name: Run FPL Rankings Sync
        run: python scripts/sync_fpl.py

      # á…á‹ Scout JSON Data á€€á€­á€¯ Sync á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
      - name: Run Scout JSON Sync
        run: python scripts/sync_scouts.py

      # á†á‹ á€‘á€½á€€á€ºá€œá€¬á€á€±á€¬ scout_data.json á€€á€­á€¯ GitHub Repository á€‘á€²á€á€­á€¯á€· á€•á€¼á€”á€ºá€á€­á€™á€ºá€¸á€á€¼á€„á€ºá€¸
      - name: Commit and Push JSON Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add scout_data.json
          # á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€™á€¾á€¯á€›á€¾á€­á€™á€¾á€á€¬ Commit á€œá€¯á€•á€ºá€™á€Šá€º
          git commit -m "ğŸ¤– Auto-update: Scout Data (Gameweek Sync)" || echo "No changes to commit"
          
          git push
